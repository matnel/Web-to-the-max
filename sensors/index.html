<hml>
<head>
<title>Accelometer & geolocation</title>
<script type='text/javascript' src='../libs/jquery.js'></script>
</head>
<body>

<div id='block' style='background: pink; width: 20px; height: 20px; position: absolute; display: none;'>

<script type='text/javascript'>

function accelometer( event ) {
    // TODO: Are these correct?
    var z = event.alpha;
    var x = event.beta;
    var y = event.gamma;

    var win = $(window);
    var block = $('#block');

    var dx = block.position().top;
    var dy = block.position().left;

   if( Math.abs( x ) > 30 ) {
       dx = dx - x;
       if( dx < 0 ) dx = 0;
       if( dx > win.height() - block.height() ) dx = win.height() - block.height();
   }

   if( Math.abs( y ) > 30 ) {
	dy = dy + y;
	if( dy < 0 ) dy = 0;
	if( dy > win.width() - block.width() ) dy = win.width() - block.width();
   }

   block.css('top', dx + 'px' );
   block.css('left', dy + 'px' );

}

$().ready( function() {

   console.log('jee');
   if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(location, noLocation);
   } else {
      noLocation();
   }

} );

function noLocation(a) {
   $('#block').show();
   window.addEventListener('deviceorientation', accelometer );
}

function location( data ) {
  var lat = data.coords.latitude;
  var long = data.coords.longitude;
  lat = Math.abs( lat );
  long = Math.abs( long );
  // scale lat/long
  lat = lat / 90 * $(window).height();
  long = long / 180 * $(window).width();
  $('#block').css( { 'left': long + 'px', 'top': lat + 'px' } ); 
  $('#block').show();
  window.addEventListener('deviceorientation', accelometer );
}

</script>

</body>
</html>
